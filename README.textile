webtasks.xml — набор Ant-сценариев для сборки веб-проектов. Содержит в себе определение классов для работы с "YUICompressor":http://developer.yahoo.com/yui/compressor/ и "Google Closure Compiler":http://code.google.com/closure/compiler/, а также набор задач для удобной склейки нескольких файлов в один.

h2. Список задач

h3. @<compress-css dir="/path/to/source/" todir="/path/to/result/" force="true|false">@

Минифицирует все CSS-файлы в папке @dir@, сохраняя результат в папку @todir@. Если исходный файл не менялся, то минифицированная версия заново не генерируется, что экономит ресурсы и время при сборке. Можно принудительно генерировать минифицированную версию, указав атрибут @force="true"@.

Особенностью этой этой задачи является замена ссылок ==<code>@import url(_file.css)</code>== на содержимое подключаемого файла. Причём заменяются только те файлы, имя которых начинается с символа подчёркивания. Например, скрипт заменит ссылку ==<code>@import url(_file.css)</code>==, но ==<code>@import url(file.css)</code>== останется как есть.

Пока поддерживается только один уровень вложенности импортов, то есть ссылка ==<code>@import url(_file2.css)</code>== внутри файла @_file.css@ не будет заменена.

h3. @<compress-single-file file="/path/to/file.js" todir="/path/to dir/" />@

Минифицирует один СSS или JS-файл @file@ и сохраняет результат в папке @todir@

h3. @<compress-js-lib tofile="/path/to/result.js" force="true|false">...</compress-js-lib>@

Склеивает и минифицирует через YUICompressor набор JS-файлов в один файл. Список файлов указывается врутри вызова задачи. Так же, как и в @<compress-css/>@ проверяются даты модификации исходных и минифицированных файлов, экономя время и ресурсы при сборке.

Пример вызова:
==<pre><code>
&lt;compress-js-lib tofile=&quot;${js}/lib.js&quot;&gt;
	&lt;filelist dir=&quot;${js-src}&quot;&gt;
		&lt;file name=&quot;file1.js&quot;/&gt;
		&lt;file name=&quot;file2.js&quot;/&gt;
	&lt;/filelist&gt;
&lt;/compress-js-lib&gt;
</code></pre>==

h3. @<compress-js-lib-log tofile="/path/to/result.js" force="true|false">...</compress-js-lib-log>@

То же самое, что и @<compress-js-lib/>@, но ведёт лог файлов, из которых состоит сжатый JS-файл.

h2. Что такое «лог файлов»

Лог файлов — это список исходных JS-файлов, из которых состоит сжатый файл. Его очень удобно использовать на production-сервере для отладки скриптов: например, по определённому запросу CMS сайта может выводить не минифицированный файл, а набор исходных файлов. Лог выглядит следующим образом:
==<pre><code>
file:/project/js/compiled-lib1.js
    file:/project/js-src/file1.js
    file:/project/js-src/file2.js
file:/project/js/compiled-lib2.js
    file:/project/js-src/file3.js
    file:/project/js-src/file4.js
</code></pre>==

То есть путь к минифицированному файлу, а под ним — список исходных файлов, отбитых символом табуляции. Этот текстовый файл можно сконвертировать в xml-формат с помощью задачи @<convert-log-to-xml/>@ (см. @webtasks-example.xml@). XML-файл выглягит так:

==<pre><code>
&lt;files&gt;
	&lt;file src=&quot;/js/compiled-lib1.js&quot;&gt;
		&lt;file src=&quot;/js-src/file1.js&quot;/&gt;
		&lt;file src=&quot;/js-src/file2.js&quot;/&gt;
	&lt;/file&gt;
	&lt;file src=&quot;/js/compiled-lib2.js&quot;&gt;
		&lt;file src=&quot;/js-src/file3.js&quot;/&gt;
		&lt;file src=&quot;/js-src/file4.js&quot;/&gt;
	&lt;/file&gt;
&lt;/files&gt;
</code></pre>==